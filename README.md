# jamsite

A searchable chord chart archive and PWA. Static site generated by Python, served by nginx in Docker.

## Setup

Requires Python 3.11+. Uses [uv](https://docs.astral.sh/uv/) for dependency management.

```
git clone git@github.com:skrul/jamsite.git
cd jamsite
uv sync
```

### Google API credentials

You need Google API credentials to read the song spreadsheet and access Google Drive.

1. Create a Google Cloud project with the **Sheets API** and **Drive API** enabled
2. Create an OAuth client ID (Web Application) with `http://localhost:8080/` as an authorized redirect URI
3. Download `credentials.json` and place it in the project root
4. Run any command that requires auth (e.g. `--sync`) to complete the OAuth flow

### Dropbox credentials

For syncing Gary's songs from Dropbox:

```
uv run jamsite --dropbox-auth
```

## Commands

Songs are stored on a case-sensitive APFS volume at `/Volumes/songs/data` by default (override with `SONGS_DIR` env var).

### Sync metadata from source folders to spreadsheet

```
uv run jamsite --sync              # Google Drive songs
uv run jamsite --sync-gary         # Dropbox songs
```

### Download song PDFs

```
uv run jamsite --download
```

### Generate the static site

```
uv run jamsite --generate
```

Use `--cached` to skip fetching songs from the spreadsheet (uses a local pickle cache from the last fetch):

```
uv run jamsite --generate --cached
```

### Serve locally

```
uv run jamsite --serve
```

Then visit http://localhost:8000/

### Dev mode (for JS/CSS changes)

```
uv run jamsite --dev
```

Requires a prior `--generate` run. Copies JS/CSS to `dist/`, starts the dev server, and watches for file changes. When you edit a file in `jamsite/js/` or `jamsite/css/`, assets are re-copied automatically -- just reload the browser.

This skips the slow spreadsheet fetch and template rendering, so it's much faster for frontend iteration.

### Check data quality

```
uv run jamsite --check
uv run jamsite --check --check-years    # also check song years via MusicBrainz
```

### Publish to S3

```
uv run jamsite --publish --aws-profile <profile>
```

## Deploying to production

On the server (`jamsite.local`):

```
cd /root/jamsite && git pull
cd /root && docker compose build && docker compose up -d
```

The container entrypoint runs `jamsite --generate` and copies output to the nginx html directory.
