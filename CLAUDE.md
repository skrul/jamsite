# Jamsite - Project Notes

## What this is
A chord chart archive and searchable PWA. Static site generated by Python, served by nginx in Docker.

## Architecture
- **Python CLI** (`jamsite/jamsite.py`): sync metadata, download PDFs, generate site, publish
- **Frontend**: vanilla JS, Skeleton CSS, no framework. PWA with offline support via service worker.
- **Metadata**: Google Sheets spreadsheet with two tabs ("skrul" for Google Drive songs, "gary" for Dropbox songs)
- **Song sources**: skrul's Google Drive folder, Gary's Dropbox folder
- **Search**: trie-based prefix search, built at generate time, runs client-side

## Server (jamsite.local)
- SSH: `ssh root@jamsite.local`
- Repo on server: `/root/jamsite`
- Songs on server: `/data/songs/` (~2500 PDFs + .json metadata files)
- Docker compose config: `/root/docker-compose.yaml`
- Two containers: `root-jamsite-1` (nginx + site) and `root-gotenberg-1` (doc-to-PDF conversion)
- SSL certs: Let's Encrypt at `/etc/letsencrypt/live/skrul.com/`
- Credentials on server: `/root/token.pickle`, `/root/dropbox_token.txt`, `/root/credentials.json`

## Deploying changes
1. Pull latest code on server (`/root/jamsite`)
2. `docker compose build && docker compose up -d` from `/root/`
3. The entrypoint runs `jamsite --generate` and copies output to nginx html dir

## Local songs volume
On the dev Mac, songs are stored on a dedicated case-sensitive APFS volume at `/Volumes/songs/data`. This is the default `SONGS_DIR`. The volume was created with `diskutil apfs addVolume` â€” it shares space with the main disk, no partitioning needed.

## Downloading new songs
The download command writes PDFs to `/data/songs/` which is mounted into the container at the same path.

## Key file paths
| File | Purpose |
|------|---------|
| `jamsite/jamsite.py` | Main CLI - sync, download, generate, serve, publish |
| `jamsite/song.py` | Song data model |
| `jamsite/store.py` | Google Drive and Dropbox API integration |
| `jamsite/search_indexer.py` | Builds trie search index |
| `jamsite/trie.py` | Trie data structure |
| `jamsite/google_api/auth.py` | OAuth2 auth for Google APIs |
| `jamsite/templates/index.html` | Jinja2 main page template |
| `jamsite/js/` | Frontend JS modules (search, song table, service worker, etc.) |
| `jamsite/css/` | Stylesheets |
| `dist/` | Generated static site output (gitignored) |

## Related: packeteer repo
`/Users/skrul/dev/packeteer/` contains tools for monthly jam sessions:
- `jam_downloader.py` - downloads chord sheet PDFs from monthly jam Google Docs
- `packeteer.py` - combines PDFs into a single packet with ordering strategies
- `archive_builder.py` - bulk scans multiple jam docs, builds manifest, downloads songs
- `musicbrainz_lookup.py` - artist/song year lookups with caching
